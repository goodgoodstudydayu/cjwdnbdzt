## hadoop相较于其他系统的优势

计算机硬盘发展趋势：寻址时间的提升远不及传输速率的提升

hadoop适合批处理，一次写入，多次读取的情景   
关系数据库更适合建立索引后数据低延迟的的点查询与快速更新，持续更新
现在hadoop与关系数据库的界限变得模糊，hadoop增加了索引以及事务，关系数据库吸收hadoop思想

hadoop非常适合半结构化数据（电子表格）以及非结构化数据（图像数据，文本数据）
hadoop是“读时模式”，即只是做了拷贝操作，避免数据加载时的高开销
web服务器日志是典型的非结构化数据，因为每次都要出现服务器主机名，冗余

map任务以及reduce任务分布在不同的节点上运行，可线性扩展，如果数据数据增加一倍，集群扩充一倍，作业运行时间不变  

**------34页1.5.2**

hadoop是无共享框架，mapreduce计算任务之间是独立的，这样才能保证在节点挂掉导致的任务失败可以在其他正常的节点上重新运行。

mapreduce的设计目标：
1.为只需要几分钟或者几小时就可以完成的作业提供服务。
2.运行于内部有高速网络传输的数据中心内。
3.数据中心内的计算机都是可靠的、专门的硬件。

map阶段中间结果写在硬盘中，一旦整个作业完成，中间结果就会被删除，如果写道hdfs中还需要对文件进行备份，小题大做。
reduce的输入不具备本地化的优势，map阶段所有中间结果都传入一个reduce，必然会走网络传输。
reduce的输出存储在hdfs上，第一个副本存储在本地节点
如果有多个reduce的话默认map分区器是哈希分区器，map阶段结束对文件进行分区

hdfs只支持单一用户写入，写操作总是以只添加的方式写在文件末尾
hdfs块大小与磁盘传输速率有关，达到磁盘寻址时间/传输时间=1%。也就是寻址时间10ms，传输速率为100MB/s时，块大小为100
随着磁盘传输速率的提升，块大小可以被设置的更大，目前默认128M
块抽象的好处：
1.可以保存比任意一个磁盘更大的文件，文件会被分成若干个块分布在不同的节点上。
2.简化存储子系统的设计。如namenode对块的元数据管理。
3.更适合数据备份，提高容错，可用性。

namenode负责管理文件系统的命名空间。维护文件系统数据以及整棵树内所有的文件和目录。这些信息以两个文件形式永久保存在本地磁盘
namespace镜像文件fsimage和操作日志文件edit log。
也记录块所在节点的信息，不永久保存，在系统启动时datanode会上报给namenode进行重建。

datanode会检索以及存储数据块，并且定期向namenode上报数据块信息
通常datanode会从磁盘中读取文件，但对于频繁访问的文件，对应的块可能被显示的缓存在datanode内存，以堆外块缓存的形式存在。
默认一个块只会缓存在一个datanode上。可以针对每个文件配置datanode数量（用户通过在缓存池告诉namenode需要缓存那些文件以及缓存多久）

naenode容错机制2种：
1.备份备份文件系统元数据文件。配置namenode在多个文件系统上保存元数据的持久状态。元数据写操作实时同步，是原子操作
如写入到远程挂载的网络文件系统（nfs）。
2.2nn辅助namenode定期合并编辑日志与命名空间镜像，防止编辑日志过大。
2nn在没有namenode的节点上运行，需要占用大量的cpu时间，需要与namenode一样多的内存。但在namenode发生故障时，2nn总是会滞后一些
会丢失部分数据。在这种情况下，一般把存储在nfs上的数据复制到2nn上。由2nn代替namenode。

**------72页3.2.4**






















